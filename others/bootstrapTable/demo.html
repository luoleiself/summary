<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>bootstrapTable</title>
  <link rel="stylesheet" type="text/css" href="./src/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="./src/bootstrap-table.min.css">
  <link rel="stylesheet" type="text/css" href="./src/font-awesome.min.css">
  <!--[if lt IE 9]>
    <script src="./src/html5shiv.min.js"></script>
    <script src="./src/respond.min.js"></script>
  <![endif]-->
  <script type="text/javascript" src="./src/jquery-1.12.4.min.js"></script>
  <script type="text/javascript" src="./src/bootstrap-table.min.js"></script>
  <script type="text/javascript" src="./src/bootstrap-table-zh-CN.min.js"></script>
  <style>
    label{
      line-height:34px;
    }
  </style>
</head>
<body>
  <!-- 表格数据加载 -->
  <div class="table-responsive"> 
    <div id="toolbar">
      <a href="javascript:void(0);" class="btn btn-primary" onclick="addRow(event)">
        <i class="icon-plus"></i> 添加
      </a> 
      <a href="javascript:void(0);" class="btn btn-primary" onclick="insertRow(event)">
        <i class="icon-lightbulb"></i> 插入
      </a>
    </div>
    <table id="tbl" data-unique-id="id" data-toggle="table" data-classes="table table-hover">
      <!-- <thead>
        <tr>
          <th></th>
        </tr>
      </thead> -->
    </table>
  </div>
  <!-- 模态框 -->
  <div class="modal fade rowInfo" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="exampleInput1" class="col-sm-3 text-right">编号:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" name="id" id="exampleInput1" placeholder="" readonly="readonly"> 
              </div>
            </div>
            <div class="form-group">
              <label for="exampleInput2" class="col-sm-3 text-right">名字:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" name="name" id="exampleInput2" placeholder=""> 
              </div>
            </div> 
            <div class="form-group">
              <label for="exampleInput3" class="col-sm-3 text-right">价格:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" name="price" id="exampleInput3" placeholder=""> 
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default confirm">提交</button>
          <button type="button" class="btn btn-primary cancel" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 公共弹窗 -->
  <div class="modal fade popCommon" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title">提示信息</h4>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default confirm" data-dismiss="modal">确定</button>
          <button type="button" class="btn btn-primary cancel" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  var data = [];
  for(let i=1;i<=100;i++){
    let obj = {id:"",name:"",price:""};
    obj.id = i;
    obj.name = "test"+i;
    obj.price = "$"+i;
    data.push(obj);
  }
  $("#tbl").bootstrapTable({
    data:data,
    method:"POST",
    cache:false,
    dataType:"json",
    showExport: true,//显示导出按钮  
    exportDataType: "basic",//导出类型
    pagination:true,
    sidePagination:"client",//分页实现方式，默认server
    pageNumber:1,
    pageSize:10,
    pageList:[10,20,30,40,50,100],
    // paginationHAlign:"left",//分页条的水平显示位置，默认right
    // paginationDetailHAlign:"right",//分页详情的水平显示位置，默认left
    paginationPreText:"<<",//分页按钮的上一页的提示字符
    paginationNextText:">>",//分页按钮的下一页的提示字符
    // buttonsAlign:"left",//工具条按钮的显示位置，默认right
    showRefresh:true,//显示刷新按钮
    // showToggle:true,//显示表格视图切换选项卡
    clickToSelect:true,//点击行选中
    singleSelect:true,
    classes:"table table-hover table-condensed",
    striped:true,
    iconsPrefix:"fa",
    height:430,
    undefinedText:"",//数据为undefine时的替换字符
    toolbar:"#toolbar",
    responseHandler:function(res){
      console.log(res);
      return res;
    },
    queryParams:function(params){
      return params;
    },
    columns:[
      {field: 'state',checkbox: true,align:"center",valign:"middle"},
      {field: 'number',title:"序号",align:"center",valign:"middle",formatter:function(value,row,index){
        return index+1;
      }},
      {field:"id",title:"编号",align:"center",valign:"middle"},
      {field:"name",title:"名字",align:"center",valign:"middle"},
      {field:"price",title:"价格",align:"center",valign:"middle"},
      {field:"operate",title:"操作",align:"center",valign:"middle",formatter:function(value,row,index){
        return "<a href='javascript:;' onclick='editRow(event,"+index+")'>编辑</a>&nbsp;&nbsp;<a href='javascript:;' onclick='deleteRow(event)'>删除</a>";
      }}
    ],
    onClickRow:function(row,$element,field){
      //console.log(row);
      // console.log($element);
      // console.log(field);
    },
    onLoadSuccess:function(data){
      // console.log(data);
    }
  })
  // 添加row 
  function addRow(e){
    let $rowInfo = $(".rowInfo");
    $rowInfo.modal("show");
    $rowInfo.find(".modal-title").text("添加数据");
    $rowInfo.find(".modal-title").attr("ind","1");
    $rowInfo.find("input").val("");
    $rowInfo.find("[name=id]").val(parseInt(data[data.length-1].id) + 1);
  }
  // 插row
  function insertRow(e){
    let row = $("#tbl").bootstrapTable("getSelections");
    if(row.length){
      let $rowInfo = $(".rowInfo");
      $rowInfo.modal("show");
      $rowInfo.find(".modal-title").text("插入数据");
      $rowInfo.find(".modal-title").attr("ind","3");
      $rowInfo.find("input").val("");
      Array.prototype.clone = function(){ 
        return this.slice(0); 
      } 
      let tempArr = data.clone();
      tempArr.sort(function(a,b){
        return a.id - b.id;
      })
      $rowInfo.find("[name=id]").val(parseInt(tempArr[tempArr.length-1].id) + 1);
      tempArr = null;
    }else{
      popCommon("icon-remove-sign","在插入记录之前请选择一条记录!");
    }
  }
  // 修改row
  function editRow(e,index){
    e.preventDefault();
    // console.log(index);
    // console.log($("#tbl").bootstrapTable("getRowByUniqueId",index+1));
    // debugger;
    let result = $(e.target).parent().parent();
    let $rowInfo = $(".rowInfo");
    $rowInfo.modal("show");
    $rowInfo.find(".modal-title").text("修改数据");
    $rowInfo.find(".modal-title").attr("ind","2");
    $rowInfo.find("[name=id]").val(result[0].children[2].innerText);
    $rowInfo.find("[name=name]").val(result[0].children[3].innerText);
    $rowInfo.find("[name=price]").val(result[0].children[4].innerText);
  }
  // 删除row
  function deleteRow(e){
    e.preventDefault();
    let result = $(e.target).parent().parent();
    data.forEach(function(value,index,arr){
      parseInt(value.id) == parseInt(result[0].children[2].innerText) ? data.splice(index,1) : "";
    })
    $("#tbl").bootstrapTable("load",data);
  }
  //提示框公共消息
  function popCommon(icn,msg){
    $(".popCommon").modal("show");
    $(".popCommon .modal-body").html('<p class="text-center"><i class='+icn+'></i> <span>'+msg+'</span></p>');
  }
  // 提交按钮事件
  $(".rowInfo .confirm").on('click',function(event) {
    event.preventDefault();
    let $rowInfo = $(".rowInfo"),obj = {};
    let result = $rowInfo.find("form").serializeArray();
    let ind = $rowInfo.find(".modal-title").attr("ind");
    result.forEach(function(value,index,arr){
      obj[value.name] = value.value;
    })
    if(ind == "1"){
      data.push(obj);
      popCommon("icon-ok-sign","添加成功");
    }else if(ind == "2"){
      data.forEach(function(value,index,arr){
        value.id == obj.id ? (value.name = obj.name,value.price = obj.price) : "" ;
      })
      popCommon("icon-ok-sign","修改成功");
    }else{
      let idd = $("#tbl").bootstrapTable("getSelections")[0].id;
      data.forEach(function(value,index,arr){
        value.id == idd ? data.splice(index+1,0,obj) : "";
      })
      popCommon("icon-ok-sign","插入成功");
    }
    $rowInfo.modal("hide");
    $("#tbl").bootstrapTable("load",data);
  });
</script>
</html>