# Vue 3.x

## 应用配置

```javascript
// 每个 Vue 应用会暴露一个 config 对象, 在挂载应用之前, 可修改其属性
import { createApp } from 'vue';
const app = createApp({});
console.log(app.config);
```

- errorHandler 处理组件渲染过程中抛出的未捕获错误

  - 类型: Function
  - 默认: undefined

  ```javascript
  app.config.errorHandler = (err, vm, info) => {
    // 处理错误
  };
  ```

- warnHandler 处理 Vue 运行中的警告, 开发环境下有效

  - 类型: Function
  - 默认: undefined

  ```javascript
  app.config.warnHandler = (msg, vm, trace) => {
    // 处理警告
  };
  ```

- globalProperties 添加应用程序内任何组件实例都可访问的全局 property, 属性名冲突时,组件内 property 优先

  - 类型: [key: string]: any
  - 默认: undefined

  ```javascript
  // Vue 2.x
  Vue.prototype.$xhr = () => {};
  // Vue 3.x
  app.config.globalProperties.$xhr = () => {};
  ```

- isCustomElement 指定一个方法, 用来识别在 Vue 之外定义的自定义元素, 如果组件符合此条件, 则不需要本地或全局注册

  > 注意, 所有原生 HTML 和 SVG 标记不需要在此函数中匹配——Vue 解析器自动执行此检查

  - 类型: (tag: string) => boolean
  - 默认: undefined

  ```javascript
  app.config.isCustomElement = (tag) => tag.startsWith('icon-');
  ```

- optionMergeStrategies 合并策略选项分别接收在父实例和子实例上定义的该选项的值作为第一个和第二个参数, 引用上下文实例被作为第三个参数传入

  - 类型: { [key: string]: Function }
  - 默认: {}

  ```javascript
  const app = Vue.createApp({
    mounted() {
      console.log(this.$options.hello);
    },
  });
  app.config.optionMergeStrategies.hello = (parent, child, vm) => {
    return `Hello, ${child}`;
  };
  app.mixin({
    hello: 'Vue',
  });
  // 'Hello, Vue'
  ```

- performance 启用对组件初始化、编译、渲染和更新的性能追踪

  - 类型: boolean
  - 默认: false

  ```javascript
  app.config.performance = true;
  ```

## 应用 API

> 调用 createApp 返回一个应用实例，该实例提供了一个应用上下文, 应用实例挂载的整个组件树共享相同的上下文

- component 注册或检索全局组件

  - 参数
    - {string} name
    - {Function | Object} [definition]
  - 返回值
    - 传入 definition 参数，返回应用实例
    - 不传入 definition 参数，返回组件定义

  ```javascript
  import { createApp } from 'vue';
  const app = createApp({});
  // 注册一个名为 my-component 的组件
  app.component('my-component', {
    /* ... */
  });
  // 检索注册的组件(始终返回构造函数)
  const MyComponent = app.component('my-component');
  ```

- config 应用配置对象
- directive 注册或检索全局指令

  - 参数
    - {string} name
    - {Function | Object} [definition]
  - 返回值
    - 传入 definition 参数，返回应用实例
    - 不传入 definition 参数，返回指令定义

  ```javascript
  import { createApp, onCreated, onMounted } from 'vue';
  const app = createApp({});
  // 注册
  app.directive('my-directive', {
    // 指令是具有一组生命周期的钩子：
    // 在绑定元素的 attribute 或事件监听器被应用之前调用
    created(el, binding, vnode, prevNode) {},
    // 在绑定元素的父组件挂载之前调用
    beforeMount(el, binding, vnode, prevNode) {},
    // 绑定元素的父组件被挂载时调用
    mounted(el, binding, vnode, prevNode) {},
    // 在包含组件的 VNode 更新之前调用
    beforeUpdate(el, binding, vnode, prevNode) {},
    // 在包含组件的 VNode 及其子组件的 VNode 更新之后调用
    updated(el, binding, vnode, prevNode) {},
    // 在绑定元素的父组件卸载之前调用
    beforeUnmount(el, binding, vnode, prevNode) {},
    // 卸载绑定元素的父组件时调用
    unmounted(el, binding, vnode, prevNode) {},
  });
  // 注册 (功能指令)
  app.directive('my-directive', () => {
    // 这将被作为 `mounted` 和 `updated` 调用
  });
  // getter, 如果已注册，则返回指令定义
  const myDirective = app.directive('my-directive');
  ```

- mixin 将一个 mixin 应用到整个应用范围内

  - 参数
    - {Object} mixin
  - 返回值: 应用实例

  ```javascript
  import { createApp } from 'vue';
  const app = createApp({});
  app.mixin({});
  ```

- mount 挂载应用实例

  - 参数
    - {Element | string} rootContainer
    - {boolean} isHydrate
  - 返回值: 根组件实例

  ```javascript
  <body>
    <div id='my-app'></div>
  </body>;
  import { createApp } from 'vue';
  const app = createApp({});
  // 做一些必要的准备
  app.mount('#my-app');
  ```

- unmount 卸载应用实例的根组件

```javascript
<body>
  <div id='my-app'></div>
</body>;
import { createApp } from 'vue';
const app = createApp({});
// 做一些必要的准备
app.mount('#my-app');
// 挂载5秒后，应用将被卸载
setTimeout(() => app.unmount(), 5000);
```

- provide 设置一个可以被注入到应用范围内所有组件中的值

  - 参数
    - {string | Symbol} key
    - value
  - 返回值: 应用实例

  ```javascript
  import { createApp } from 'vue';
  const app = createApp({
    inject: ['user'],
    template: `
      <div>
        {{ user }}
      </div>
    `,
  });
  app.provide('user', 'administrator');
  ```

- use 安装 Vue.js 插件。如果插件是一个对象，它必须暴露一个 install 方法。如果它本身是一个函数，它将被视为安装方法

  - 参数
    - {Object | Function} plugin
    - ...options (可选)
  - 返回值: 应用实例

  ```javascript
  import { createApp } from 'vue';
  import MyPlugin from './plugins/MyPlugin';
  const app = createApp({});
  app.use(MyPlugin);
  app.mount('#app');
  ```

## 全局 API

- createApp 返回一个提供应用上下文的应用实例,应用实例挂载的整个组件树共享同一个上下文

  - 参数
    - {Object} rootConf 根组件选项对象
    - {Object} propConf 根 prop

  ```javascript
  import { createApp } from 'vue';
  const app = createApp(
    {
      props: ['username'],
      data() {
        return {};
      },
      methods: {},
      computed: {},
    },
    { username: 'Hello World' }
  );
  ```

- h 返回一个"虚拟节点",通常缩写为 VNode：一个普通对象，其中包含向 Vue 描述它应在页面上渲染哪种节点的信息,包括所有子节点的描述

  - 参数
    - {String | Object | Function} type
    - {Object} props
    - {String | Array} children

  ```javascript
  render() {
    // 使用返回 null 的函数将渲染一个注释
    return Vue.h('div', {}, [
      Vue.h(null, {}, [' Annotation start ']),
      Vue.h('h2', {}, ['Hello World']),
      Vue.h('p', {}, 'This is a label p, it contain description...'),
      Vue.h(null, {}, [' Annotation end '])
    ])
  }
  ```

- defineComponent 创建一个合成类型的构造函数,用于手动渲染函数

  1. 具有组件选项的对象

  ```javascript
  import { defineComponent } from 'vue';
  const MyComponent = defineComponent({
    data() {
      return { count: 1 };
    },
    methods: {
      increment() {
        this.count++;
      },
    },
  });
  ```

  1. 一个 setup 函数, 函数名称作为组件名称使用

  ```javascript
  import { defineComponent, ref } from 'vue';
  const HelloWorld = defineComponent(function HelloWorld() {
    const count = ref(0);
    return { count };
  });
  ```
